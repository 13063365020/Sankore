<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>Open-Sankoré: Sankore-3.1/src/core/UBDownloadManager.cpp Source File</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">Open-Sankoré
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.1.2 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="../../pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="../../namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="../../annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="../../files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="../../search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="../../search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="../../files.html"><span>File&#160;List</span></a></li>
      <li><a href="../../globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Properties</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(11)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(12)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="../../dir_6fc3cff80e7745fc3f93f5539daaa27b.html">Sankore-3.1</a></li><li class="navelem"><a class="el" href="../../dir_667baa572e9e8f5ece3bd51e5bbbf100.html">src</a></li><li class="navelem"><a class="el" href="../../dir_7d6d68be4f452814e43b66a7c76c6136.html">core</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">UBDownloadManager.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<a href="../../dc/da9/_u_b_download_manager_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment"> * Copyright (C) 2010-2013 Groupement d&#39;Intérêt Public pour l&#39;Education Numérique en Afrique (GIP ENA)</span></div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment"> * This file is part of Open-Sankoré.</span></div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment"> * Open-Sankoré is free software: you can redistribute it and/or modify</span></div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment"> * it under the terms of the GNU General Public License as published by</span></div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment"> * the Free Software Foundation, version 3 of the License,</span></div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment"> * with a specific linking exception for the OpenSSL project&#39;s</span></div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment"> * &quot;OpenSSL&quot; library (or with modified versions of it that use the</span></div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment"> * same license as the &quot;OpenSSL&quot; library).</span></div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment"> * Open-Sankoré is distributed in the hope that it will be useful,</span></div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="comment"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</span></div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="comment"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span></div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="comment"> * GNU General Public License for more details.</span></div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="comment"> * You should have received a copy of the GNU General Public License</span></div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="comment"> * along with Open-Sankoré.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</span></div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;</div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;</div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;</div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d6/d34/_u_b_download_manager_8h.html">UBDownloadManager.h</a>&quot;</span></div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../db/d54/_u_b_application_8h.html">core/UBApplication.h</a>&quot;</span></div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d0/de5/_u_b_persistence_manager_8h.html">core/UBPersistenceManager.h</a>&quot;</span></div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d2/d3c/_u_b_main_window_8h.html">gui/UBMainWindow.h</a>&quot;</span></div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../dd/ddb/_u_b_board_controller_8h.html">board/UBBoardController.h</a>&quot;</span></div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../df/d29/_u_b_board_palette_manager_8h.html">board/UBBoardPaletteManager.h</a>&quot;</span></div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d2/db5/_u_b_file_system_utils_8h.html">frameworks/UBFileSystemUtils.h</a>&quot;</span></div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;</div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../db/d80/memcheck_8h.html">core/memcheck.h</a>&quot;</span></div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;</div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;</div>
<div class="line"><a name="l00035"></a><span class="lineno"><a class="code" href="../../de/d41/class_u_b_async_local_file_downloader.html#aa478d28188280404ab6efd50d1e65215">   35</a></span>&#160;<a class="code" href="../../de/d41/class_u_b_async_local_file_downloader.html#aa478d28188280404ab6efd50d1e65215">UBAsyncLocalFileDownloader::UBAsyncLocalFileDownloader</a>(<a class="code" href="../../d5/d15/structs_download_file_desc.html">sDownloadFileDesc</a> <a class="code" href="../../da/d13/_u_b_http_get_8cpp.html#afde83e8a66b1328a06c071b0cc7e6f36">desc</a>, QByteArray data, QObject *parent)</div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;: QThread(parent)</div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;, mDesc(desc)</div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;, mData(data)</div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;, m_bAborting(false)</div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;{</div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;</div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;}</div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;</div>
<div class="line"><a name="l00044"></a><span class="lineno"><a class="code" href="../../de/d41/class_u_b_async_local_file_downloader.html#a062ea63c2e94e990281c44e4c9644067">   44</a></span>&#160;<a class="code" href="../../de/d41/class_u_b_async_local_file_downloader.html">UBAsyncLocalFileDownloader</a> *<a class="code" href="../../de/d41/class_u_b_async_local_file_downloader.html#a062ea63c2e94e990281c44e4c9644067">UBAsyncLocalFileDownloader::download</a>()</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;{</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;    start();</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">this</span>;</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;}</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;</div>
<div class="line"><a name="l00050"></a><span class="lineno"><a class="code" href="../../de/d41/class_u_b_async_local_file_downloader.html#a44ea40c0b8421713cebe98cfacd2e02d">   50</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../de/d41/class_u_b_async_local_file_downloader.html#a44ea40c0b8421713cebe98cfacd2e02d">UBAsyncLocalFileDownloader::run</a>()</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;{</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;    <a class="code" href="../../de/d41/class_u_b_async_local_file_downloader.html#aa19b8a3609e8265b638f811ceadd9c24">mMutex</a>.lock();</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;    <a class="code" href="../../d5/d15/structs_download_file_desc.html">sDownloadFileDesc</a> descriptor = <a class="code" href="../../de/d41/class_u_b_async_local_file_downloader.html#af1f2bc6f6398455e5113fd68f5232a03">mDesc</a>;</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;    <a class="code" href="../../de/d41/class_u_b_async_local_file_downloader.html#aa19b8a3609e8265b638f811ceadd9c24">mMutex</a>.unlock();</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;    descriptor.<a class="code" href="../../d5/d15/structs_download_file_desc.html#a4a988f6add910812e0b8a5166ecb39d9">srcUrl</a> = QUrl::fromUserInput(descriptor.<a class="code" href="../../d5/d15/structs_download_file_desc.html#a4a988f6add910812e0b8a5166ecb39d9">srcUrl</a>).toLocalFile();</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;    QString mimeType = <a class="code" href="../../d2/d7a/class_u_b_file_system_utils.html#a272b08b8f8907091333982fb53a7aa2a">UBFileSystemUtils::mimeTypeFromFileName</a>(descriptor.<a class="code" href="../../d5/d15/structs_download_file_desc.html#a4a988f6add910812e0b8a5166ecb39d9">srcUrl</a>);</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;    <span class="keywordtype">int</span> position=mimeType.indexOf(<span class="stringliteral">&quot;;&quot;</span>);</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;    <span class="keywordflow">if</span>(position != -1)</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;        mimeType=mimeType.left(position);</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;    <a class="code" href="../../df/da5/struct_u_b_mime_type.html#af592aa3f37be1b755c0d5dfd7dd76acb">UBMimeType::Enum</a> itemMimeType = <a class="code" href="../../d2/d7a/class_u_b_file_system_utils.html#a793ff3d89661ee4663b8a2f055b87b60">UBFileSystemUtils::mimeTypeFromString</a>(mimeType);</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;    QString destDirectory;</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../df/da5/struct_u_b_mime_type.html#af592aa3f37be1b755c0d5dfd7dd76acba62f11ab936a2f1f2581eadc8e087a7cc">UBMimeType::Video</a> == itemMimeType)</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;        destDirectory = <a class="code" href="../../d0/dd5/class_u_b_persistence_manager.html#a6d2a1dff335f20f14fba15798c778aa7">UBPersistenceManager::videoDirectory</a>;</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="../../df/da5/struct_u_b_mime_type.html#af592aa3f37be1b755c0d5dfd7dd76acba41f3d067d53df1cf2d818a4317ed080a">UBMimeType::Audio</a> == itemMimeType)</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;            destDirectory = <a class="code" href="../../d0/dd5/class_u_b_persistence_manager.html#ad68b2f4bbd480f2119432f4b6f4b20d3">UBPersistenceManager::audioDirectory</a>;</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;    <span class="keywordflow">if</span> (descriptor.<a class="code" href="../../d5/d15/structs_download_file_desc.html#a1b6e4c982c432d3db9339e2eab20ab81">originalSrcUrl</a>.isEmpty())</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;        descriptor.<a class="code" href="../../d5/d15/structs_download_file_desc.html#a1b6e4c982c432d3db9339e2eab20ab81">originalSrcUrl</a> = descriptor.<a class="code" href="../../d5/d15/structs_download_file_desc.html#a4a988f6add910812e0b8a5166ecb39d9">srcUrl</a>;</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;    QString uuid = QUuid::createUuid();</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;    <a class="code" href="../../d0/dd5/class_u_b_persistence_manager.html#ad8b7a880564523143d73c6b86d887769">UBPersistenceManager::persistenceManager</a>()-&gt;<a class="code" href="../../d0/dd5/class_u_b_persistence_manager.html#acd23e0a499945e39b27cf663f0236ce1">addFileToDocument</a>(<a class="code" href="../../d8/d81/class_u_b_application.html#a34aa9a6616b61208ada7ff5fb228e5ff">UBApplication::boardController</a>-&gt;selectedDocument(),</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;                                                                  descriptor.<a class="code" href="../../d5/d15/structs_download_file_desc.html#a4a988f6add910812e0b8a5166ecb39d9">srcUrl</a>,</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;                                                                  destDirectory,</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;                                                                  uuid,</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;                                                                  <a class="code" href="../../de/d41/class_u_b_async_local_file_downloader.html#a3df76ebb1a88ce91c209c3c3faedf07b">mTo</a>,</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;                                                                  NULL);</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../de/d41/class_u_b_async_local_file_downloader.html#ad75046e430fe5c88b441c2b6443e3786">m_bAborting</a>)</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;    {</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;        <span class="keywordflow">if</span> (QFile::exists(<a class="code" href="../../de/d41/class_u_b_async_local_file_downloader.html#a3df76ebb1a88ce91c209c3c3faedf07b">mTo</a>))</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;            QFile::remove(<a class="code" href="../../de/d41/class_u_b_async_local_file_downloader.html#a3df76ebb1a88ce91c209c3c3faedf07b">mTo</a>);</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;    }</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;        emit <a class="code" href="../../de/d41/class_u_b_async_local_file_downloader.html#ab35449afc5e3fb50f3e0cd22aff89293">signal_asyncCopyFinished</a>(descriptor.<a class="code" href="../../d5/d15/structs_download_file_desc.html#a09153ec49d55f18d9ad36aaa57b0e11f">id</a>, !<a class="code" href="../../de/d41/class_u_b_async_local_file_downloader.html#a3df76ebb1a88ce91c209c3c3faedf07b">mTo</a>.isEmpty(), QUrl::fromLocalFile(<a class="code" href="../../de/d41/class_u_b_async_local_file_downloader.html#a3df76ebb1a88ce91c209c3c3faedf07b">mTo</a>), QUrl(descriptor.<a class="code" href="../../d5/d15/structs_download_file_desc.html#a1b6e4c982c432d3db9339e2eab20ab81">originalSrcUrl</a>), <span class="stringliteral">&quot;&quot;</span>, NULL, descriptor.<a class="code" href="../../d5/d15/structs_download_file_desc.html#a187d0504d19892e2d483f47a349b6194">pos</a>, descriptor.<a class="code" href="../../d5/d15/structs_download_file_desc.html#aff74b0da56f2a5921847c1ab5c013476">size</a>, descriptor.<a class="code" href="../../d5/d15/structs_download_file_desc.html#ad945d24ca6d26c992c66e95c0447f165">isBackground</a>);</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;}</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;</div>
<div class="line"><a name="l00094"></a><span class="lineno"><a class="code" href="../../de/d41/class_u_b_async_local_file_downloader.html#a083f79b69abcbd9a8830a866c390f888">   94</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../de/d41/class_u_b_async_local_file_downloader.html#a083f79b69abcbd9a8830a866c390f888">UBAsyncLocalFileDownloader::abort</a>()</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;{</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;    <a class="code" href="../../de/d41/class_u_b_async_local_file_downloader.html#ad75046e430fe5c88b441c2b6443e3786">m_bAborting</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;}</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;</div>
<div class="line"><a name="l00100"></a><span class="lineno"><a class="code" href="../../dc/da9/_u_b_download_manager_8cpp.html#a44d0020d78e42642d1e0a0cab05f7707">  100</a></span>&#160;<span class="keyword">static</span> <a class="code" href="../../d7/d38/class_u_b_download_manager.html">UBDownloadManager</a>* <a class="code" href="../../dc/da9/_u_b_download_manager_8cpp.html#a44d0020d78e42642d1e0a0cab05f7707">pInstance</a> = NULL;</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;</div>
<div class="line"><a name="l00107"></a><span class="lineno"><a class="code" href="../../d7/d38/class_u_b_download_manager.html#a692880b623fa16bda278a35de605db8c">  107</a></span>&#160;<a class="code" href="../../d7/d38/class_u_b_download_manager.html#a692880b623fa16bda278a35de605db8c" title="Constructor.">UBDownloadManager::UBDownloadManager</a>(QObject *parent, <span class="keyword">const</span> <span class="keywordtype">char</span> *name):QObject(parent)</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;{</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;    setObjectName(name);</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;    <a class="code" href="../../d7/d38/class_u_b_download_manager.html#a4e4cf467c14617da96e07f91f847a85c" title="Initialize the download manager.">init</a>();</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;    connect(<span class="keyword">this</span>, SIGNAL(<a class="code" href="../../d7/d38/class_u_b_download_manager.html#ab6721a82bf700a33b3801f9b61356123">fileAddedToDownload</a>()), <span class="keyword">this</span>, SLOT(<a class="code" href="../../d7/d38/class_u_b_download_manager.html#adf2b12cbfdb5457f3eec6a09b0ec4145" title="Update the download list. If a current download is finished, we take a file from the pending download...">onUpdateDownloadLists</a>()));</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;}</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;</div>
<div class="line"><a name="l00118"></a><span class="lineno"><a class="code" href="../../d7/d38/class_u_b_download_manager.html#a9950f99fdb58538f60e3d7a629fb6354">  118</a></span>&#160;<a class="code" href="../../d7/d38/class_u_b_download_manager.html#a9950f99fdb58538f60e3d7a629fb6354" title="Destructor.">UBDownloadManager::~UBDownloadManager</a>()</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;{</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;}</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;</div>
<div class="line"><a name="l00127"></a><span class="lineno"><a class="code" href="../../d7/d38/class_u_b_download_manager.html#a98ec03d9a74e118191b17197a7b942a8">  127</a></span>&#160;<a class="code" href="../../d7/d38/class_u_b_download_manager.html">UBDownloadManager</a>* <a class="code" href="../../d7/d38/class_u_b_download_manager.html#a98ec03d9a74e118191b17197a7b942a8" title="Get the download manager.">UBDownloadManager::downloadManager</a>()</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;{</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;    <span class="keywordflow">if</span>(NULL == pInstance)</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;    {</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;        pInstance = <span class="keyword">new</span> <a class="code" href="../../d7/d38/class_u_b_download_manager.html#a692880b623fa16bda278a35de605db8c" title="Constructor.">UBDownloadManager</a>();</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;    }</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="../../dc/da9/_u_b_download_manager_8cpp.html#a44d0020d78e42642d1e0a0cab05f7707">pInstance</a>;</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;}</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;</div>
<div class="line"><a name="l00136"></a><span class="lineno"><a class="code" href="../../d7/d38/class_u_b_download_manager.html#a6ee82a598099579a2e8b903541c788a6">  136</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d7/d38/class_u_b_download_manager.html#a6ee82a598099579a2e8b903541c788a6">UBDownloadManager::destroy</a>()</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;{</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;    <span class="keywordflow">if</span>(pInstance)</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;    {</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;        <span class="keyword">delete</span> <a class="code" href="../../dc/da9/_u_b_download_manager_8cpp.html#a44d0020d78e42642d1e0a0cab05f7707">pInstance</a>;</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;    }</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;    pInstance = NULL;</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;}</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;</div>
<div class="line"><a name="l00149"></a><span class="lineno"><a class="code" href="../../d7/d38/class_u_b_download_manager.html#a1256f03bf7e614a35236fcd55ebdbdb6">  149</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="../../d7/d38/class_u_b_download_manager.html#a1256f03bf7e614a35236fcd55ebdbdb6" title="Add a file to the download list.">UBDownloadManager::addFileToDownload</a>(<a class="code" href="../../d5/d15/structs_download_file_desc.html">sDownloadFileDesc</a> <a class="code" href="../../da/d13/_u_b_http_get_8cpp.html#afde83e8a66b1328a06c071b0cc7e6f36">desc</a>)</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;{</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;    <span class="comment">// Set the ID for this download</span></div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;    desc.<a class="code" href="../../d5/d15/structs_download_file_desc.html#a09153ec49d55f18d9ad36aaa57b0e11f">id</a> = <a class="code" href="../../d7/d38/class_u_b_download_manager.html#a163aa1d6ee899fb8a5ae2e3c9d9ae56f">mLastID</a>;</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;    <a class="code" href="../../d7/d38/class_u_b_download_manager.html#a163aa1d6ee899fb8a5ae2e3c9d9ae56f">mLastID</a>++;</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;    <span class="comment">// Add the file to the pending download list</span></div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;    <a class="code" href="../../d7/d38/class_u_b_download_manager.html#a006a58dcf7241750324c83561c1ea6e9">mPendingDL</a>.append(desc);</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;    <span class="comment">// If the download is modal, show the download dialog</span></div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;    <span class="keywordflow">if</span>(desc.<a class="code" href="../../d5/d15/structs_download_file_desc.html#abb72982d76747d63dca453ef483b3a3e">modal</a>)</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;    {</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;        <span class="comment">// Update the download order (priority to modal files)</span></div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;        <a class="code" href="../../d7/d38/class_u_b_download_manager.html#ae979b3d627ce5f6d531bcedb58aef010" title="Update the download order. The modal downloads will be put in priority.">updateDownloadOrder</a>();</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;        <a class="code" href="../../d8/d81/class_u_b_application.html#a369dfaccbdf3a0089ca67f093a7fd31d">UBApplication::mainWindow</a>-&gt;<a class="code" href="../../d8/d9e/class_u_b_main_window.html#ae2949414a83e39ea1e86ed36dd875cb8">showDownloadWidget</a>();</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;    }</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;    <a class="code" href="../../d8/d81/class_u_b_application.html#a34aa9a6616b61208ada7ff5fb228e5ff">UBApplication::boardController</a>-&gt;<a class="code" href="../../d7/d62/class_u_b_board_controller.html#a536e1388e74f79a2120d0e585b862033">paletteManager</a>()-&gt;<a class="code" href="../../dc/d38/class_u_b_board_palette_manager.html#ac22e898462f43afb35fd929ef6523bfd">startDownloads</a>();</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;    emit <a class="code" href="../../d7/d38/class_u_b_download_manager.html#ab6721a82bf700a33b3801f9b61356123">fileAddedToDownload</a>();</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;    <span class="keywordflow">return</span> desc.<a class="code" href="../../d5/d15/structs_download_file_desc.html#a09153ec49d55f18d9ad36aaa57b0e11f">id</a>;</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;}</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;</div>
<div class="line"><a name="l00175"></a><span class="lineno"><a class="code" href="../../d7/d38/class_u_b_download_manager.html#a4e4cf467c14617da96e07f91f847a85c">  175</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d7/d38/class_u_b_download_manager.html#a4e4cf467c14617da96e07f91f847a85c" title="Initialize the download manager.">UBDownloadManager::init</a>()</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;{</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;    <a class="code" href="../../d7/d38/class_u_b_download_manager.html#a6a117624f78a6779a2c49d441d95ff6d">mCrntDL</a>.clear();</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;    <a class="code" href="../../d7/d38/class_u_b_download_manager.html#a006a58dcf7241750324c83561c1ea6e9">mPendingDL</a>.clear();</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;    <a class="code" href="../../d7/d38/class_u_b_download_manager.html#a4bc0b2c57c72d0a1619805c534c9a502">mDownloads</a>.clear();</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;    <a class="code" href="../../d7/d38/class_u_b_download_manager.html#a163aa1d6ee899fb8a5ae2e3c9d9ae56f">mLastID</a> = 1;</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;    <a class="code" href="../../d7/d38/class_u_b_download_manager.html#aeaef3b3a3ac29882b16616e9c18aaa4b">mDLAvailability</a>.clear();</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0; i&lt;<a class="code" href="../../d6/d34/_u_b_download_manager_8h.html#a419b3607bafd7d43a7b7ce82982a6ef5">SIMULTANEOUS_DOWNLOAD</a>; i++)</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;    {</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;        <a class="code" href="../../d7/d38/class_u_b_download_manager.html#aeaef3b3a3ac29882b16616e9c18aaa4b">mDLAvailability</a>.append(-1);</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;    }</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;}</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;</div>
<div class="line"><a name="l00191"></a><span class="lineno"><a class="code" href="../../d7/d38/class_u_b_download_manager.html#ae979b3d627ce5f6d531bcedb58aef010">  191</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d7/d38/class_u_b_download_manager.html#ae979b3d627ce5f6d531bcedb58aef010" title="Update the download order. The modal downloads will be put in priority.">UBDownloadManager::updateDownloadOrder</a>()</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;{</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;    QVector&lt;sDownloadFileDesc&gt; modalFiles;</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;    QVector&lt;sDownloadFileDesc&gt; nonModalfiles;</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0; i&lt;<a class="code" href="../../d7/d38/class_u_b_download_manager.html#a006a58dcf7241750324c83561c1ea6e9">mPendingDL</a>.size(); i++)</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;    {</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;        <a class="code" href="../../d5/d15/structs_download_file_desc.html">sDownloadFileDesc</a> crnt = <a class="code" href="../../d7/d38/class_u_b_download_manager.html#a006a58dcf7241750324c83561c1ea6e9">mPendingDL</a>.at(i);</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;        <span class="keywordflow">if</span>(crnt.<a class="code" href="../../d5/d15/structs_download_file_desc.html#abb72982d76747d63dca453ef483b3a3e">modal</a>)</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;        {</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;            modalFiles.append(crnt);</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;        }</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;        {</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;            nonModalfiles.append(crnt);</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;        }</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;    }</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;    <a class="code" href="../../d7/d38/class_u_b_download_manager.html#a006a58dcf7241750324c83561c1ea6e9">mPendingDL</a> = modalFiles + nonModalfiles;</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;}</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;</div>
<div class="line"><a name="l00216"></a><span class="lineno"><a class="code" href="../../d7/d38/class_u_b_download_manager.html#adf2b12cbfdb5457f3eec6a09b0ec4145">  216</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d7/d38/class_u_b_download_manager.html#adf2b12cbfdb5457f3eec6a09b0ec4145" title="Update the download list. If a current download is finished, we take a file from the pending download...">UBDownloadManager::onUpdateDownloadLists</a>()</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;{</div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0; i&lt;<a class="code" href="../../d6/d34/_u_b_download_manager_8h.html#a419b3607bafd7d43a7b7ce82982a6ef5">SIMULTANEOUS_DOWNLOAD</a>; i++)</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;    {</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="../../d7/d38/class_u_b_download_manager.html#a006a58dcf7241750324c83561c1ea6e9">mPendingDL</a>.empty())</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;        {</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;            <span class="comment">// If we fall here that means that there is no pending download</span></div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;        }</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;        <span class="keywordflow">if</span>(-1 == <a class="code" href="../../d7/d38/class_u_b_download_manager.html#aeaef3b3a3ac29882b16616e9c18aaa4b">mDLAvailability</a>.at(i))        {</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;            <span class="comment">// Pending downloads exist and a download &#39;slot&#39; is available</span></div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;            <span class="comment">// Let&#39;s move the first pending download to the current download</span></div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;            <span class="comment">// list and fill the slot</span></div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;            <a class="code" href="../../d5/d15/structs_download_file_desc.html">sDownloadFileDesc</a> <a class="code" href="../../da/d13/_u_b_http_get_8cpp.html#afde83e8a66b1328a06c071b0cc7e6f36">desc</a> = <a class="code" href="../../d7/d38/class_u_b_download_manager.html#a006a58dcf7241750324c83561c1ea6e9">mPendingDL</a>.at(0);</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;            <a class="code" href="../../d7/d38/class_u_b_download_manager.html#a6a117624f78a6779a2c49d441d95ff6d">mCrntDL</a>.append(desc);</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;            <a class="code" href="../../d7/d38/class_u_b_download_manager.html#a006a58dcf7241750324c83561c1ea6e9">mPendingDL</a>.remove(0);</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;            <a class="code" href="../../d7/d38/class_u_b_download_manager.html#aeaef3b3a3ac29882b16616e9c18aaa4b">mDLAvailability</a>.remove(i);</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;            <a class="code" href="../../d7/d38/class_u_b_download_manager.html#aeaef3b3a3ac29882b16616e9c18aaa4b">mDLAvailability</a>.insert(i, desc.<a class="code" href="../../d5/d15/structs_download_file_desc.html#a09153ec49d55f18d9ad36aaa57b0e11f">id</a>);</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;            <span class="comment">// Start the download of this file</span></div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;            <a class="code" href="../../d7/d38/class_u_b_download_manager.html#aac0b212ca97453fb8d342d110d375f10" title="Start the download of a file.">startFileDownload</a>(desc);</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;        }</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;    }</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;}</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;</div>
<div class="line"><a name="l00245"></a><span class="lineno"><a class="code" href="../../d7/d38/class_u_b_download_manager.html#acefaa070ff6fcbabb908d16e4a807b59">  245</a></span>&#160;QVector&lt;sDownloadFileDesc&gt; <a class="code" href="../../d7/d38/class_u_b_download_manager.html#acefaa070ff6fcbabb908d16e4a807b59" title="Get the list of the current downloads.">UBDownloadManager::currentDownloads</a>()</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;{</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="../../d7/d38/class_u_b_download_manager.html#a6a117624f78a6779a2c49d441d95ff6d">mCrntDL</a>;</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;}</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;</div>
<div class="line"><a name="l00254"></a><span class="lineno"><a class="code" href="../../d7/d38/class_u_b_download_manager.html#a4beef0fa708d68bcf92f73b029ed9f60">  254</a></span>&#160;QVector&lt;sDownloadFileDesc&gt; <a class="code" href="../../d7/d38/class_u_b_download_manager.html#a4beef0fa708d68bcf92f73b029ed9f60" title="Get the list of the pending downloads.">UBDownloadManager::pendingDownloads</a>()</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;{</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="../../d7/d38/class_u_b_download_manager.html#a006a58dcf7241750324c83561c1ea6e9">mPendingDL</a>;</div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;}</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;</div>
<div class="line"><a name="l00263"></a><span class="lineno"><a class="code" href="../../d7/d38/class_u_b_download_manager.html#a77a59012fcfa733fc3a2dbffc1605a55">  263</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d7/d38/class_u_b_download_manager.html#a77a59012fcfa733fc3a2dbffc1605a55" title="Update the file transfer information.">UBDownloadManager::onDownloadProgress</a>(<span class="keywordtype">int</span> <span class="keywordtype">id</span>, qint64 received, qint64 total)</div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;{</div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;    <a class="code" href="../../d7/d38/class_u_b_download_manager.html#a713a817fe469e641786c6d8a61778b95" title="Update the description of the given current downloaded file.">updateFileCurrentSize</a>(<span class="keywordtype">id</span>, received, total);</div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;}</div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;</div>
<div class="line"><a name="l00273"></a><span class="lineno"><a class="code" href="../../d7/d38/class_u_b_download_manager.html#a50e08fa88d965346e81a3100bd72f8cf">  273</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d7/d38/class_u_b_download_manager.html#a50e08fa88d965346e81a3100bd72f8cf" title="Called when the download of the given file is finished.">UBDownloadManager::onDownloadFinished</a>(<span class="keywordtype">int</span> <span class="keywordtype">id</span>, <span class="keywordtype">bool</span> pSuccess, QUrl sourceUrl, QUrl contentUrl, QString pContentTypeHeader, QByteArray pData, QPointF pPos, QSize pSize, <span class="keywordtype">bool</span> isBackground)</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;{</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;<span class="comment">//    Temporary data for dnd do not delete it please</span></div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;    Q_UNUSED(pPos)</div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;    Q_UNUSED(pSize)</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;    Q_UNUSED(isBackground)</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0; i&lt;<a class="code" href="../../d7/d38/class_u_b_download_manager.html#a6a117624f78a6779a2c49d441d95ff6d">mCrntDL</a>.size(); i++)</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;    {</div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;        <a class="code" href="../../d5/d15/structs_download_file_desc.html">sDownloadFileDesc</a> <a class="code" href="../../da/d13/_u_b_http_get_8cpp.html#afde83e8a66b1328a06c071b0cc7e6f36">desc</a> = <a class="code" href="../../d7/d38/class_u_b_download_manager.html#a6a117624f78a6779a2c49d441d95ff6d">mCrntDL</a>.at(i);</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;        <span class="keywordflow">if</span>(<span class="keywordtype">id</span> == desc.<a class="code" href="../../d5/d15/structs_download_file_desc.html#a09153ec49d55f18d9ad36aaa57b0e11f">id</a>)</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;        {</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;            <span class="keywordflow">if</span> (desc.<a class="code" href="../../d5/d15/structs_download_file_desc.html#aa28d39c1093b42e10e2c521954178fd3">dest</a> == <a class="code" href="../../d5/d15/structs_download_file_desc.html#ad995f6191451705cb58a55a5dff81967ae864913bd9830ff680cb0ea069586055">sDownloadFileDesc::graphicsWidget</a>) {</div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;                desc.<a class="code" href="../../d5/d15/structs_download_file_desc.html#a1c01babcf4424316306f17ed49245aaf">contentTypeHeader</a> = pContentTypeHeader;</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;                emit <a class="code" href="../../d7/d38/class_u_b_download_manager.html#a12c47cd2fab70aef25ee7896ac8d5fe8">downloadFinished</a>(pSuccess, desc, pData);</div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;            }</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;            <span class="keywordflow">else</span> <span class="keywordflow">if</span>(desc.<a class="code" href="../../d5/d15/structs_download_file_desc.html#aa28d39c1093b42e10e2c521954178fd3">dest</a> == <a class="code" href="../../d5/d15/structs_download_file_desc.html#ad995f6191451705cb58a55a5dff81967a6ef5ab3b2839a0d96153d3c9c51923d3">sDownloadFileDesc::board</a>) {</div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;                <span class="comment">// The downloaded file is modal so we must put it on the board</span></div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;                emit <a class="code" href="../../d7/d38/class_u_b_download_manager.html#a7211a4b322171a3d7e714a29ca527432">addDownloadedFileToBoard</a>(pSuccess, sourceUrl, contentUrl, pContentTypeHeader, pData, pPos, pSize, <span class="keyword">false</span>, isBackground);</div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;            }</div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;            <span class="keywordflow">else</span> <span class="keywordflow">if</span>(desc.<a class="code" href="../../d5/d15/structs_download_file_desc.html#aa28d39c1093b42e10e2c521954178fd3">dest</a> == <a class="code" href="../../d5/d15/structs_download_file_desc.html#ad995f6191451705cb58a55a5dff81967a806447250426771aa072c85cebddafb2">sDownloadFileDesc::library</a>)</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;            {</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;                emit <a class="code" href="../../d7/d38/class_u_b_download_manager.html#a516812f4416db050a3123d91c367bee4">addDownloadedFileToLibrary</a>(pSuccess, sourceUrl, pContentTypeHeader, pData, desc.<a class="code" href="../../d5/d15/structs_download_file_desc.html#a77186047aac4272ab2dbfff324911214">name</a>);</div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;            }</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;        }</div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;    }</div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;</div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;    <span class="comment">// Then do this</span></div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;    <a class="code" href="../../d7/d38/class_u_b_download_manager.html#a713a817fe469e641786c6d8a61778b95" title="Update the description of the given current downloaded file.">updateFileCurrentSize</a>(<span class="keywordtype">id</span>);</div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;}</div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;</div>
<div class="line"><a name="l00311"></a><span class="lineno"><a class="code" href="../../d7/d38/class_u_b_download_manager.html#a713a817fe469e641786c6d8a61778b95">  311</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d7/d38/class_u_b_download_manager.html#a713a817fe469e641786c6d8a61778b95" title="Update the description of the given current downloaded file.">UBDownloadManager::updateFileCurrentSize</a>(<span class="keywordtype">int</span> <span class="keywordtype">id</span>, qint64 received, qint64 total)</div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;{</div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0; i&lt;<a class="code" href="../../d7/d38/class_u_b_download_manager.html#a6a117624f78a6779a2c49d441d95ff6d">mCrntDL</a>.size();i++)</div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;    {</div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="../../d7/d38/class_u_b_download_manager.html#a6a117624f78a6779a2c49d441d95ff6d">mCrntDL</a>.at(i).id == id)</div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;        {</div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;            <a class="code" href="../../d5/d15/structs_download_file_desc.html">sDownloadFileDesc</a> <a class="code" href="../../da/d13/_u_b_http_get_8cpp.html#afde83e8a66b1328a06c071b0cc7e6f36">desc</a> = <a class="code" href="../../d7/d38/class_u_b_download_manager.html#a6a117624f78a6779a2c49d441d95ff6d">mCrntDL</a>.at(i);</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;            <span class="keywordflow">if</span>(received &gt;= 0 &amp;&amp; total &gt;= 0)</div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;            {</div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;                <span class="comment">// -------------------------------------</span></div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;                <span class="comment">// [=============== x% ====            ]</span></div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;                <span class="comment">// -------------------------------------</span></div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;                desc.<a class="code" href="../../d5/d15/structs_download_file_desc.html#aab346a62032910198e1701d51737d37b">currentSize</a> = received;</div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;                desc.<a class="code" href="../../d5/d15/structs_download_file_desc.html#a8edfff7d9fc9da8b982caf2bacbb9819">totalSize</a> = total;</div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;</div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;                emit <a class="code" href="../../d7/d38/class_u_b_download_manager.html#acf269f1cf2f15126043b4b113489c0a7">downloadUpdated</a>(<span class="keywordtype">id</span>, received, total);</div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;            }</div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;            <span class="keywordflow">else</span></div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;            {</div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;                <span class="comment">// -------------------------------------</span></div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;                <span class="comment">// [=============== 100% ==============]</span></div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;                <span class="comment">// -------------------------------------</span></div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;                <span class="comment">// received and total are negative. That means that the download is finished</span></div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;                desc.<a class="code" href="../../d5/d15/structs_download_file_desc.html#aab346a62032910198e1701d51737d37b">currentSize</a> = <a class="code" href="../../d7/d38/class_u_b_download_manager.html#a6a117624f78a6779a2c49d441d95ff6d">mCrntDL</a>.at(i).totalSize;</div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;</div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;                <span class="comment">// Remove the finished file from the current download list</span></div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;                <a class="code" href="../../d7/d38/class_u_b_download_manager.html#a6a117624f78a6779a2c49d441d95ff6d">mCrntDL</a>.remove(i);</div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;</div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;                <span class="comment">// Here we don&#39;t forget to remove the reply related to the finished download</span></div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;                <a class="code" href="../../d7/d38/class_u_b_download_manager.html#a4bc0b2c57c72d0a1619805c534c9a502">mDownloads</a>.remove(<span class="keywordtype">id</span>);</div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;</div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;                <span class="comment">// Free the download slot used by the finished file</span></div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;                <span class="keywordflow">for</span>(<span class="keywordtype">int</span> j=0; j&lt;<a class="code" href="../../d7/d38/class_u_b_download_manager.html#aeaef3b3a3ac29882b16616e9c18aaa4b">mDLAvailability</a>.size();j++)</div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;                {</div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;                    <span class="keywordflow">if</span>(<span class="keywordtype">id</span> == <a class="code" href="../../d7/d38/class_u_b_download_manager.html#aeaef3b3a3ac29882b16616e9c18aaa4b">mDLAvailability</a>.at(j))</div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;                    {</div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;                        <a class="code" href="../../d7/d38/class_u_b_download_manager.html#aeaef3b3a3ac29882b16616e9c18aaa4b">mDLAvailability</a>.remove(j);</div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;                        <a class="code" href="../../d7/d38/class_u_b_download_manager.html#aeaef3b3a3ac29882b16616e9c18aaa4b">mDLAvailability</a>.insert(j, -1);</div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;                        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;                    }</div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;                }</div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;</div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;                <span class="comment">// Here we check if some modal downloads remain</span></div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;                <a class="code" href="../../d7/d38/class_u_b_download_manager.html#a73e2f336b08e0c1805f421567eec26ea" title="Verify if modal downloads remains and notify everyone if it is not the case.">checkIfModalRemains</a>();</div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;</div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;                <span class="comment">// Then we update the list of downloads</span></div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;                <a class="code" href="../../d7/d38/class_u_b_download_manager.html#adf2b12cbfdb5457f3eec6a09b0ec4145" title="Update the download list. If a current download is finished, we take a file from the pending download...">onUpdateDownloadLists</a>();</div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;</div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;                emit <a class="code" href="../../d7/d38/class_u_b_download_manager.html#a12c47cd2fab70aef25ee7896ac8d5fe8">downloadFinished</a>(<span class="keywordtype">id</span>);</div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;</div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;                <span class="comment">// Verify if all downloads are finished</span></div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;                <span class="keywordflow">if</span>(<a class="code" href="../../d7/d38/class_u_b_download_manager.html#a6a117624f78a6779a2c49d441d95ff6d">mCrntDL</a>.empty() &amp;&amp; <a class="code" href="../../d7/d38/class_u_b_download_manager.html#a006a58dcf7241750324c83561c1ea6e9">mPendingDL</a>.empty())</div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;                {</div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;                    <a class="code" href="../../d7/d38/class_u_b_download_manager.html#aeb9ff1954a7c94d18c7d37f1b1f85729">finishDownloads</a>();</div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;                }</div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;</div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;            }</div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;</div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;            <a class="code" href="../../d7/d38/class_u_b_download_manager.html#a6a117624f78a6779a2c49d441d95ff6d">mCrntDL</a>.remove(i);</div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;            <a class="code" href="../../d7/d38/class_u_b_download_manager.html#a6a117624f78a6779a2c49d441d95ff6d">mCrntDL</a>.insert(i,desc);</div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;        }</div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;    }</div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;}</div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;</div>
<div class="line"><a name="l00381"></a><span class="lineno"><a class="code" href="../../d7/d38/class_u_b_download_manager.html#aac0b212ca97453fb8d342d110d375f10">  381</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d7/d38/class_u_b_download_manager.html#aac0b212ca97453fb8d342d110d375f10" title="Start the download of a file.">UBDownloadManager::startFileDownload</a>(<a class="code" href="../../d5/d15/structs_download_file_desc.html">sDownloadFileDesc</a> <a class="code" href="../../da/d13/_u_b_http_get_8cpp.html#afde83e8a66b1328a06c071b0cc7e6f36">desc</a>)</div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;{</div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;    <span class="keywordflow">if</span> (desc.<a class="code" href="../../d5/d15/structs_download_file_desc.html#a4a988f6add910812e0b8a5166ecb39d9">srcUrl</a>.startsWith(<span class="stringliteral">&quot;file://&quot;</span>) || desc.<a class="code" href="../../d5/d15/structs_download_file_desc.html#a4a988f6add910812e0b8a5166ecb39d9">srcUrl</a>.startsWith(<span class="stringliteral">&quot;/&quot;</span>))</div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;    {</div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;        <a class="code" href="../../de/d41/class_u_b_async_local_file_downloader.html">UBAsyncLocalFileDownloader</a> * cpHelper = <span class="keyword">new</span> <a class="code" href="../../de/d41/class_u_b_async_local_file_downloader.html">UBAsyncLocalFileDownloader</a>(desc, QByteArray(), <span class="keyword">this</span>);</div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;        connect(cpHelper, SIGNAL(signal_asyncCopyFinished(<span class="keywordtype">int</span>, <span class="keywordtype">bool</span>, QUrl, QUrl, QString, QByteArray, QPointF, QSize, <span class="keywordtype">bool</span>)), <span class="keyword">this</span>, SLOT(<a class="code" href="../../d7/d38/class_u_b_download_manager.html#a50e08fa88d965346e81a3100bd72f8cf" title="Called when the download of the given file is finished.">onDownloadFinished</a>(<span class="keywordtype">int</span>, <span class="keywordtype">bool</span>, QUrl, QUrl,QString, QByteArray, QPointF, QSize, <span class="keywordtype">bool</span>)));</div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;        QObject *res = <span class="keyword">dynamic_cast&lt;</span>QObject *<span class="keyword">&gt;</span>(cpHelper-&gt;<a class="code" href="../../de/d41/class_u_b_async_local_file_downloader.html#a062ea63c2e94e990281c44e4c9644067">download</a>());</div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;        <span class="keywordflow">if</span> (!res)</div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;            <span class="keyword">delete</span> res;</div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;            <a class="code" href="../../d7/d38/class_u_b_download_manager.html#a4bc0b2c57c72d0a1619805c534c9a502">mDownloads</a>[desc.<a class="code" href="../../d5/d15/structs_download_file_desc.html#a09153ec49d55f18d9ad36aaa57b0e11f">id</a>] = res;</div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;    }</div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;    {</div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;        <a class="code" href="../../da/d3e/class_u_b_download_http_file.html">UBDownloadHttpFile</a>* http = <span class="keyword">new</span> <a class="code" href="../../da/d3e/class_u_b_download_http_file.html">UBDownloadHttpFile</a>(desc.<a class="code" href="../../d5/d15/structs_download_file_desc.html#a09153ec49d55f18d9ad36aaa57b0e11f">id</a>, <span class="keyword">this</span>);</div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;        connect(http, SIGNAL(downloadProgress(<span class="keywordtype">int</span>, qint64,qint64)), <span class="keyword">this</span>, SLOT(<a class="code" href="../../d7/d38/class_u_b_download_manager.html#a77a59012fcfa733fc3a2dbffc1605a55" title="Update the file transfer information.">onDownloadProgress</a>(<span class="keywordtype">int</span>,qint64,qint64)));</div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;        connect(http, SIGNAL(<a class="code" href="../../d7/d38/class_u_b_download_manager.html#a12c47cd2fab70aef25ee7896ac8d5fe8">downloadFinished</a>(<span class="keywordtype">int</span>, <span class="keywordtype">bool</span>, QUrl, QUrl, QString, QByteArray, QPointF, QSize, <span class="keywordtype">bool</span>)), <span class="keyword">this</span>, SLOT(<a class="code" href="../../d7/d38/class_u_b_download_manager.html#a50e08fa88d965346e81a3100bd72f8cf" title="Called when the download of the given file is finished.">onDownloadFinished</a>(<span class="keywordtype">int</span>, <span class="keywordtype">bool</span>, QUrl, QUrl, QString, QByteArray, QPointF, QSize, <span class="keywordtype">bool</span>)));</div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;        connect(http, SIGNAL(downloadError(<span class="keywordtype">int</span>)), <span class="keyword">this</span>, SLOT(<a class="code" href="../../d7/d38/class_u_b_download_manager.html#aa21ea2733f35aa297519ee620a182365">onDownloadError</a>(<span class="keywordtype">int</span>)));</div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;</div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;        <span class="comment">//the desc.srcUrl is encoded. So we have to decode it before.</span></div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;        QUrl url;</div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;        url.setEncodedUrl(desc.<a class="code" href="../../d5/d15/structs_download_file_desc.html#a4a988f6add910812e0b8a5166ecb39d9">srcUrl</a>.toUtf8());</div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;        <span class="comment">// We send here the request and store its reply in order to be able to cancel it if needed</span></div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;        <a class="code" href="../../d7/d38/class_u_b_download_manager.html#a4bc0b2c57c72d0a1619805c534c9a502">mDownloads</a>[desc.<a class="code" href="../../d5/d15/structs_download_file_desc.html#a09153ec49d55f18d9ad36aaa57b0e11f">id</a>] = <span class="keyword">dynamic_cast&lt;</span>QObject *<span class="keyword">&gt;</span>(http-&gt;<a class="code" href="../../de/d40/class_u_b_http_get.html#a5c25272ca90dfb2d1d42784907d39c41">get</a>(url, desc.<a class="code" href="../../d5/d15/structs_download_file_desc.html#a187d0504d19892e2d483f47a349b6194">pos</a>, desc.<a class="code" href="../../d5/d15/structs_download_file_desc.html#aff74b0da56f2a5921847c1ab5c013476">size</a>, desc.<a class="code" href="../../d5/d15/structs_download_file_desc.html#ad945d24ca6d26c992c66e95c0447f165">isBackground</a>));</div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;    }</div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;}</div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;</div>
<div class="line"><a name="l00411"></a><span class="lineno"><a class="code" href="../../d7/d38/class_u_b_download_manager.html#a73e2f336b08e0c1805f421567eec26ea">  411</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d7/d38/class_u_b_download_manager.html#a73e2f336b08e0c1805f421567eec26ea" title="Verify if modal downloads remains and notify everyone if it is not the case.">UBDownloadManager::checkIfModalRemains</a>()</div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;{</div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;    <span class="keywordtype">bool</span> bModal = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0; i&lt;<a class="code" href="../../d7/d38/class_u_b_download_manager.html#a6a117624f78a6779a2c49d441d95ff6d">mCrntDL</a>.size();i++)</div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;    {</div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="../../d7/d38/class_u_b_download_manager.html#a6a117624f78a6779a2c49d441d95ff6d">mCrntDL</a>.at(i).modal)</div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;        {</div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;            bModal = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;        }</div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;    }</div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;</div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;    <span class="keywordflow">if</span>(!bModal)</div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;    {</div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> j=0; j&lt;<a class="code" href="../../d7/d38/class_u_b_download_manager.html#a006a58dcf7241750324c83561c1ea6e9">mPendingDL</a>.size(); j++)</div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;        {</div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;            <span class="keywordflow">if</span>(<a class="code" href="../../d7/d38/class_u_b_download_manager.html#a006a58dcf7241750324c83561c1ea6e9">mPendingDL</a>.at(j).modal)</div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;            {</div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;                bModal = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;            }</div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;        }</div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;    }</div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;</div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;    <span class="keywordflow">if</span>(bModal || (<a class="code" href="../../d7/d38/class_u_b_download_manager.html#a6a117624f78a6779a2c49d441d95ff6d">mCrntDL</a>.empty() &amp;&amp; <a class="code" href="../../d7/d38/class_u_b_download_manager.html#a006a58dcf7241750324c83561c1ea6e9">mPendingDL</a>.empty()))</div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;    {</div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;        <span class="comment">// Close the modal window</span></div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;        <a class="code" href="../../d8/d81/class_u_b_application.html#a369dfaccbdf3a0089ca67f093a7fd31d">UBApplication::mainWindow</a>-&gt;<a class="code" href="../../d8/d9e/class_u_b_main_window.html#a4b99a4654dccfb65a5599c9fb8d3fb8a">hideDownloadWidget</a>();</div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;</div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;        <span class="comment">// Notify that no modal downloads are pending</span></div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;        emit <a class="code" href="../../d7/d38/class_u_b_download_manager.html#a31e9979260c22b0cf1968eea94fd5af7">downloadModalFinished</a>();</div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;    }</div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;}</div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;</div>
<div class="line"><a name="l00448"></a><span class="lineno"><a class="code" href="../../d7/d38/class_u_b_download_manager.html#a9ec94b78d3b4eb2d003657590f3a2839">  448</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d7/d38/class_u_b_download_manager.html#a9ec94b78d3b4eb2d003657590f3a2839" title="Cancel all downloads.">UBDownloadManager::cancelDownloads</a>()</div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;{</div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;    <span class="comment">// Stop the current downloads</span></div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;    QMap&lt;int, QObject*&gt;::iterator it = <a class="code" href="../../d7/d38/class_u_b_download_manager.html#a4bc0b2c57c72d0a1619805c534c9a502">mDownloads</a>.begin();</div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;    <span class="keywordflow">for</span>(; it!=<a class="code" href="../../d7/d38/class_u_b_download_manager.html#a4bc0b2c57c72d0a1619805c534c9a502">mDownloads</a>.end();it++)</div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;    {</div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;        QNetworkReply *netReply = <span class="keyword">dynamic_cast&lt;</span>QNetworkReply*<span class="keyword">&gt;</span>(it.value());</div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;        <span class="keywordflow">if</span> (netReply)</div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;            netReply-&gt;abort();</div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;        {</div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;            <a class="code" href="../../de/d41/class_u_b_async_local_file_downloader.html">UBAsyncLocalFileDownloader</a> *localDownload = <span class="keyword">dynamic_cast&lt;</span><a class="code" href="../../de/d41/class_u_b_async_local_file_downloader.html">UBAsyncLocalFileDownloader</a> *<span class="keyword">&gt;</span>(it.value());</div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;            <span class="keywordflow">if</span> (localDownload)</div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;                localDownload-&gt;<a class="code" href="../../de/d41/class_u_b_async_local_file_downloader.html#a083f79b69abcbd9a8830a866c390f888">abort</a>();</div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;        }</div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;    }</div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;</div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;    <span class="comment">// Clear all the lists</span></div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;    <a class="code" href="../../d7/d38/class_u_b_download_manager.html#a4e4cf467c14617da96e07f91f847a85c" title="Initialize the download manager.">init</a>();</div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;</div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;    <a class="code" href="../../d7/d38/class_u_b_download_manager.html#a73e2f336b08e0c1805f421567eec26ea" title="Verify if modal downloads remains and notify everyone if it is not the case.">checkIfModalRemains</a>();</div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;</div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;    <a class="code" href="../../d7/d38/class_u_b_download_manager.html#aeb9ff1954a7c94d18c7d37f1b1f85729">finishDownloads</a>(<span class="keyword">true</span>);</div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;}</div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;</div>
<div class="line"><a name="l00473"></a><span class="lineno"><a class="code" href="../../d7/d38/class_u_b_download_manager.html#aa21ea2733f35aa297519ee620a182365">  473</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d7/d38/class_u_b_download_manager.html#aa21ea2733f35aa297519ee620a182365">UBDownloadManager::onDownloadError</a>(<span class="keywordtype">int</span> <span class="keywordtype">id</span>)</div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;{</div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;    QNetworkReply *pReply = <span class="keyword">dynamic_cast&lt;</span>QNetworkReply *<span class="keyword">&gt;</span>(<a class="code" href="../../d7/d38/class_u_b_download_manager.html#a4bc0b2c57c72d0a1619805c534c9a502">mDownloads</a>.value(<span class="keywordtype">id</span>));</div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;</div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;    <span class="keywordflow">if</span>(NULL != pReply)</div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;    {</div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;        QString errorString = tr(<span class="stringliteral">&quot;Download failed.&quot;</span>);</div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;        <span class="comment">// Check which error occured:</span></div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;        <span class="keywordflow">switch</span>(pReply-&gt;error())</div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;        {</div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;            <span class="keywordflow">case</span> QNetworkReply::ConnectionRefusedError:</div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;                errorString += <span class="stringliteral">&quot; &quot;</span> + (tr(<span class="stringliteral">&quot;the remote server refused the connection (the server is not accepting requests)&quot;</span>));</div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;            <span class="keywordflow">case</span> QNetworkReply::RemoteHostClosedError:</div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;                errorString += <span class="stringliteral">&quot; &quot;</span> + (tr(<span class="stringliteral">&quot;the remote server closed the connection prematurely, before the entire reply was received and processed&quot;</span>));</div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;            <span class="keywordflow">case</span> QNetworkReply::HostNotFoundError:</div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;                errorString += <span class="stringliteral">&quot; &quot;</span> + (tr(<span class="stringliteral">&quot;the remote host name was not found (invalid hostname)&quot;</span>));</div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;            <span class="keywordflow">case</span> QNetworkReply::TimeoutError:</div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;                errorString += <span class="stringliteral">&quot; &quot;</span> + (tr(<span class="stringliteral">&quot;the connection to the remote server timed out&quot;</span>));</div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;            <span class="keywordflow">case</span> QNetworkReply::OperationCanceledError:</div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;                errorString += <span class="stringliteral">&quot; &quot;</span> + (tr(<span class="stringliteral">&quot;the operation was canceled via calls to abort() or close() before it was finished.&quot;</span>));</div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;            <span class="keywordflow">case</span> QNetworkReply::SslHandshakeFailedError:</div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;                errorString += <span class="stringliteral">&quot; &quot;</span> + (tr(<span class="stringliteral">&quot;the SSL/TLS handshake failed and the encrypted channel could not be established. The sslErrors() signal should have been emitted.&quot;</span>));</div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;            <span class="keywordflow">case</span> QNetworkReply::TemporaryNetworkFailureError:</div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;                errorString += <span class="stringliteral">&quot; &quot;</span> + (tr(<span class="stringliteral">&quot;the connection was broken due to disconnection from the network, however the system has initiated roaming to another access point. The request should be resubmitted and will be processed as soon as the connection is re-established.&quot;</span>));</div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;            <span class="keywordflow">case</span> QNetworkReply::ProxyConnectionRefusedError:</div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;                errorString += <span class="stringliteral">&quot; &quot;</span> + (tr(<span class="stringliteral">&quot;the connection to the proxy server was refused (the proxy server is not accepting requests)&quot;</span>));</div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;            <span class="keywordflow">case</span> QNetworkReply::ProxyConnectionClosedError:</div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;                errorString += <span class="stringliteral">&quot; &quot;</span> + (tr(<span class="stringliteral">&quot;the proxy server closed the connection prematurely, before the entire reply was received and processed&quot;</span>));</div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;            <span class="keywordflow">case</span> QNetworkReply::ProxyNotFoundError:</div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;                errorString += <span class="stringliteral">&quot; &quot;</span> + (tr(<span class="stringliteral">&quot;the proxy host name was not found (invalid proxy hostname)&quot;</span>));</div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;            <span class="keywordflow">case</span> QNetworkReply::ProxyTimeoutError:</div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;                errorString += <span class="stringliteral">&quot; &quot;</span> + (tr(<span class="stringliteral">&quot;the connection to the proxy timed out or the proxy did not reply in time to the request sent&quot;</span>));</div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;            <span class="keywordflow">case</span> QNetworkReply::ProxyAuthenticationRequiredError:</div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;                errorString += <span class="stringliteral">&quot; &quot;</span> + (tr(<span class="stringliteral">&quot;the proxy requires authentication in order to honour the request but did not accept any credentials offered (if any)&quot;</span>));</div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;            <span class="keywordflow">case</span> QNetworkReply::ContentAccessDenied:</div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;                errorString += <span class="stringliteral">&quot; &quot;</span> + (tr(<span class="stringliteral">&quot;the access to the remote content was denied (similar to HTTP error 401)&quot;</span>));</div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;            <span class="keywordflow">case</span> QNetworkReply::ContentOperationNotPermittedError:</div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;                errorString += <span class="stringliteral">&quot; &quot;</span> + (tr(<span class="stringliteral">&quot;the operation requested on the remote content is not permitted&quot;</span>));</div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;            <span class="keywordflow">case</span> QNetworkReply::ContentNotFoundError:</div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;                errorString += <span class="stringliteral">&quot; &quot;</span> + (tr(<span class="stringliteral">&quot;the remote content was not found at the server (similar to HTTP error 404)&quot;</span>));</div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;            <span class="keywordflow">case</span> QNetworkReply::AuthenticationRequiredError:</div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;                errorString += <span class="stringliteral">&quot; &quot;</span> + (tr(<span class="stringliteral">&quot;the remote server requires authentication to serve the content but the credentials provided were not accepted (if any)&quot;</span>));</div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;            <span class="keywordflow">case</span> QNetworkReply::ContentReSendError:</div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;                errorString += <span class="stringliteral">&quot; &quot;</span> + (tr(<span class="stringliteral">&quot;the request needed to be sent again, but this failed for example because the upload data could not be read a second time.&quot;</span>));</div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;            <span class="keywordflow">case</span> QNetworkReply::ProtocolUnknownError:</div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;                errorString += <span class="stringliteral">&quot; &quot;</span> + (tr(<span class="stringliteral">&quot;the Network Access API cannot honor the request because the protocol is not known&quot;</span>));</div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;            <span class="keywordflow">case</span> QNetworkReply::ProtocolInvalidOperationError:</div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;                errorString += <span class="stringliteral">&quot; &quot;</span> + (tr(<span class="stringliteral">&quot;the requested operation is invalid for this protocol&quot;</span>));</div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;            <span class="keywordflow">case</span> QNetworkReply::UnknownNetworkError:</div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;                errorString += <span class="stringliteral">&quot; &quot;</span> + (tr(<span class="stringliteral">&quot;an unknown network-related error was detected&quot;</span>));</div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;            <span class="keywordflow">case</span> QNetworkReply::UnknownProxyError:</div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;                errorString += <span class="stringliteral">&quot; &quot;</span> + (tr(<span class="stringliteral">&quot;an unknown proxy-related error was detected&quot;</span>));</div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;            <span class="keywordflow">case</span> QNetworkReply::UnknownContentError:</div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;                errorString += <span class="stringliteral">&quot; &quot;</span> + (tr(<span class="stringliteral">&quot;an unknown error related to the remote content was detected&quot;</span>));</div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;            <span class="keywordflow">case</span> QNetworkReply::ProtocolFailure:</div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;                errorString += <span class="stringliteral">&quot; &quot;</span> + (tr(<span class="stringliteral">&quot;a breakdown in protocol was detected (parsing error, invalid or unexpected responses, etc.)&quot;</span>));</div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;            <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;                <span class="comment">// Check the documentation of QNetworkReply in Qt Assistant for the different error cases</span></div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;        }</div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;        <a class="code" href="../../d8/d81/class_u_b_application.html#afd12508537e75aaa6789431e60b60b44">UBApplication::showMessage</a>(errorString);</div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;        <a class="code" href="../../d7/d38/class_u_b_download_manager.html#a5425576229c8b6918a72ca6476e2be23">cancelDownload</a>(<span class="keywordtype">id</span>);</div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;    }</div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;}</div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;</div>
<div class="line"><a name="l00561"></a><span class="lineno"><a class="code" href="../../d7/d38/class_u_b_download_manager.html#aeb9ff1954a7c94d18c7d37f1b1f85729">  561</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d7/d38/class_u_b_download_manager.html#aeb9ff1954a7c94d18c7d37f1b1f85729">UBDownloadManager::finishDownloads</a>(<span class="keywordtype">bool</span> cancel)</div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;{</div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;    <a class="code" href="../../d8/d81/class_u_b_application.html#a34aa9a6616b61208ada7ff5fb228e5ff">UBApplication::boardController</a>-&gt;<a class="code" href="../../d7/d62/class_u_b_board_controller.html#a536e1388e74f79a2120d0e585b862033">paletteManager</a>()-&gt;<a class="code" href="../../dc/d38/class_u_b_board_palette_manager.html#a9b076bd5e9b0066353797f86bcfe09f8">stopDownloads</a>();</div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;    <span class="keywordflow">if</span>(cancel){</div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;        emit <a class="code" href="../../d7/d38/class_u_b_download_manager.html#a8502451de115dfa70d3ca1fad017e4cc">cancelAllDownloads</a>();</div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;    }</div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;    <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;        emit <a class="code" href="../../d7/d38/class_u_b_download_manager.html#ad035f13a1abac13e2f9aa847036bac5f">allDownloadsFinished</a>();</div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;    }</div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;}</div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;</div>
<div class="line"><a name="l00572"></a><span class="lineno"><a class="code" href="../../d7/d38/class_u_b_download_manager.html#a5425576229c8b6918a72ca6476e2be23">  572</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d7/d38/class_u_b_download_manager.html#a5425576229c8b6918a72ca6476e2be23">UBDownloadManager::cancelDownload</a>(<span class="keywordtype">int</span> <span class="keywordtype">id</span>)</div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;{</div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="../../d7/d38/class_u_b_download_manager.html#a4bc0b2c57c72d0a1619805c534c9a502">mDownloads</a>.size())</div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;</div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;    <span class="comment">// Stop the download</span></div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;</div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;    QNetworkReply *pNetworkDownload = <span class="keyword">dynamic_cast&lt;</span>QNetworkReply *<span class="keyword">&gt;</span>(<a class="code" href="../../d7/d38/class_u_b_download_manager.html#a4bc0b2c57c72d0a1619805c534c9a502">mDownloads</a>[id]);</div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;    <span class="keywordflow">if</span> (pNetworkDownload)</div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;        pNetworkDownload-&gt;abort();</div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;    {</div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;        <a class="code" href="../../de/d41/class_u_b_async_local_file_downloader.html">UBAsyncLocalFileDownloader</a> *pLocalDownload = <span class="keyword">dynamic_cast&lt;</span><a class="code" href="../../de/d41/class_u_b_async_local_file_downloader.html">UBAsyncLocalFileDownloader</a> *<span class="keyword">&gt;</span>(<a class="code" href="../../d7/d38/class_u_b_download_manager.html#a4bc0b2c57c72d0a1619805c534c9a502">mDownloads</a>[id]);</div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;        <span class="keywordflow">if</span> (pLocalDownload)</div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;        {</div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;            <span class="keywordflow">if</span> (pLocalDownload-&gt;isRunning())</div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;                pLocalDownload-&gt;<a class="code" href="../../de/d41/class_u_b_async_local_file_downloader.html#a083f79b69abcbd9a8830a866c390f888">abort</a>();</div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;        }</div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;    }</div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;</div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;    <a class="code" href="../../d7/d38/class_u_b_download_manager.html#a4bc0b2c57c72d0a1619805c534c9a502">mDownloads</a>.remove(<span class="keywordtype">id</span>);</div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;</div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;    <span class="comment">// Remove the canceled download from the download lists</span></div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;    <span class="keywordtype">bool</span> bFound = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0; i&lt;<a class="code" href="../../d7/d38/class_u_b_download_manager.html#a6a117624f78a6779a2c49d441d95ff6d">mCrntDL</a>.size(); i++){</div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;        <span class="keywordflow">if</span>(<span class="keywordtype">id</span> == <a class="code" href="../../d7/d38/class_u_b_download_manager.html#a6a117624f78a6779a2c49d441d95ff6d">mCrntDL</a>.at(i).id){</div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;            <a class="code" href="../../d7/d38/class_u_b_download_manager.html#a6a117624f78a6779a2c49d441d95ff6d">mCrntDL</a>.remove(i);</div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;            bFound = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;        }</div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;    }</div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;    <span class="keywordflow">if</span>(!bFound){</div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> j=0; j&lt;<a class="code" href="../../d7/d38/class_u_b_download_manager.html#a006a58dcf7241750324c83561c1ea6e9">mPendingDL</a>.size(); j++){</div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;            <span class="keywordflow">if</span>(<span class="keywordtype">id</span> == <a class="code" href="../../d7/d38/class_u_b_download_manager.html#a006a58dcf7241750324c83561c1ea6e9">mPendingDL</a>.at(j).id){</div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;                <a class="code" href="../../d7/d38/class_u_b_download_manager.html#a006a58dcf7241750324c83561c1ea6e9">mPendingDL</a>.remove(j);</div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;                bFound = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;            }</div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;        }</div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;    }</div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;</div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;    <span class="comment">// Free the download slot used by the finished file</span></div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> h=0; h&lt;<a class="code" href="../../d7/d38/class_u_b_download_manager.html#aeaef3b3a3ac29882b16616e9c18aaa4b">mDLAvailability</a>.size();h++){</div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;        <span class="keywordflow">if</span>(<span class="keywordtype">id</span> == <a class="code" href="../../d7/d38/class_u_b_download_manager.html#aeaef3b3a3ac29882b16616e9c18aaa4b">mDLAvailability</a>.at(h)){</div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;            <a class="code" href="../../d7/d38/class_u_b_download_manager.html#aeaef3b3a3ac29882b16616e9c18aaa4b">mDLAvailability</a>.remove(h);</div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;            <a class="code" href="../../d7/d38/class_u_b_download_manager.html#aeaef3b3a3ac29882b16616e9c18aaa4b">mDLAvailability</a>.insert(h, -1);</div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;        }</div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;    }</div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;</div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;    <span class="comment">// Here we check if some modal downloads remain</span></div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;    <a class="code" href="../../d7/d38/class_u_b_download_manager.html#a73e2f336b08e0c1805f421567eec26ea" title="Verify if modal downloads remains and notify everyone if it is not the case.">checkIfModalRemains</a>();</div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;</div>
<div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;    <span class="comment">// Then we update the list of downloads</span></div>
<div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;    <a class="code" href="../../d7/d38/class_u_b_download_manager.html#adf2b12cbfdb5457f3eec6a09b0ec4145" title="Update the download list. If a current download is finished, we take a file from the pending download...">onUpdateDownloadLists</a>();</div>
<div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;</div>
<div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;    <span class="comment">// Verify if all downloads are finished</span></div>
<div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="../../d7/d38/class_u_b_download_manager.html#a6a117624f78a6779a2c49d441d95ff6d">mCrntDL</a>.empty() &amp;&amp; <a class="code" href="../../d7/d38/class_u_b_download_manager.html#a006a58dcf7241750324c83561c1ea6e9">mPendingDL</a>.empty())</div>
<div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;    {</div>
<div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;        <a class="code" href="../../d7/d38/class_u_b_download_manager.html#aeb9ff1954a7c94d18c7d37f1b1f85729">finishDownloads</a>();</div>
<div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;    }</div>
<div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;}</div>
<div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;</div>
<div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;<span class="comment">// ------------------------------------------------------------------------------</span></div>
<div class="line"><a name="l00641"></a><span class="lineno"><a class="code" href="../../da/d3e/class_u_b_download_http_file.html#a98850a9d46ab95f8c1dc9d62bede945a">  641</a></span>&#160;<span class="comment"></span><a class="code" href="../../da/d3e/class_u_b_download_http_file.html#a98850a9d46ab95f8c1dc9d62bede945a" title="Constructor.">UBDownloadHttpFile::UBDownloadHttpFile</a>(<span class="keywordtype">int</span> fileId, QObject *parent):<a class="code" href="../../de/d40/class_u_b_http_get.html">UBHttpGet</a>(parent)</div>
<div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;{</div>
<div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;    <a class="code" href="../../da/d3e/class_u_b_download_http_file.html#a9f6bb9c926934f9076c143d96b0d716f">mId</a> = fileId;</div>
<div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;</div>
<div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;    connect(<span class="keyword">this</span>, SIGNAL(<a class="code" href="../../da/d3e/class_u_b_download_http_file.html#acd45974a11a39587251a7893894d85ee">downloadFinished</a>(<span class="keywordtype">bool</span>,QUrl,QString,QByteArray,QPointF,QSize,<span class="keywordtype">bool</span>)), <span class="keyword">this</span>, SLOT(<a class="code" href="../../da/d3e/class_u_b_download_http_file.html#a08836bac0076c435654506e837a11f5b" title="Handles the download finished notification.">onDownloadFinished</a>(<span class="keywordtype">bool</span>,QUrl,QString,QByteArray,QPointF,QSize,<span class="keywordtype">bool</span>)));</div>
<div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;    connect(<span class="keyword">this</span>, SIGNAL(<a class="code" href="../../da/d3e/class_u_b_download_http_file.html#abf929cee75fc3b5401298b6757125480">downloadProgress</a>(qint64,qint64)), <span class="keyword">this</span>, SLOT(<a class="code" href="../../da/d3e/class_u_b_download_http_file.html#a31ab571304f4b33282996f8ceece8cb1" title="Handles the download progress notification.">onDownloadProgress</a>(qint64,qint64)));</div>
<div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;}</div>
<div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;</div>
<div class="line"><a name="l00652"></a><span class="lineno"><a class="code" href="../../da/d3e/class_u_b_download_http_file.html#a7ba40f6b698ea416a921609f60981d89">  652</a></span>&#160;<a class="code" href="../../da/d3e/class_u_b_download_http_file.html#a7ba40f6b698ea416a921609f60981d89" title="Destructor.">UBDownloadHttpFile::~UBDownloadHttpFile</a>()</div>
<div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;{</div>
<div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;</div>
<div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;}</div>
<div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;</div>
<div class="line"><a name="l00662"></a><span class="lineno"><a class="code" href="../../da/d3e/class_u_b_download_http_file.html#a31ab571304f4b33282996f8ceece8cb1">  662</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../da/d3e/class_u_b_download_http_file.html#a31ab571304f4b33282996f8ceece8cb1" title="Handles the download progress notification.">UBDownloadHttpFile::onDownloadProgress</a>(qint64 bytesReceived, qint64 bytesTotal)</div>
<div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;{</div>
<div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;    emit <a class="code" href="../../da/d3e/class_u_b_download_http_file.html#abf929cee75fc3b5401298b6757125480">downloadProgress</a>(<a class="code" href="../../da/d3e/class_u_b_download_http_file.html#a9f6bb9c926934f9076c143d96b0d716f">mId</a>, bytesReceived, bytesTotal);</div>
<div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;}</div>
<div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;</div>
<div class="line"><a name="l00677"></a><span class="lineno"><a class="code" href="../../da/d3e/class_u_b_download_http_file.html#a08836bac0076c435654506e837a11f5b">  677</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../da/d3e/class_u_b_download_http_file.html#a08836bac0076c435654506e837a11f5b" title="Handles the download finished notification.">UBDownloadHttpFile::onDownloadFinished</a>(<span class="keywordtype">bool</span> pSuccess, QUrl sourceUrl, QString pContentTypeHeader, QByteArray pData, QPointF pPos, QSize pSize, <span class="keywordtype">bool</span> isBackground)</div>
<div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;{</div>
<div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;    <span class="keywordflow">if</span>(pSuccess)</div>
<div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;    {</div>
<div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;        <span class="comment">// Notify the end of the download</span></div>
<div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;        emit <a class="code" href="../../da/d3e/class_u_b_download_http_file.html#acd45974a11a39587251a7893894d85ee">downloadFinished</a>(<a class="code" href="../../da/d3e/class_u_b_download_http_file.html#a9f6bb9c926934f9076c143d96b0d716f">mId</a>, pSuccess, sourceUrl, sourceUrl, pContentTypeHeader, pData, pPos, pSize, isBackground);</div>
<div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;    }</div>
<div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;    {</div>
<div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;        <span class="comment">// Notify the fact that and error occured during the download</span></div>
<div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;        emit <a class="code" href="../../da/d3e/class_u_b_download_http_file.html#af8ea0f0a88ff715b70c6463906691fca">downloadError</a>(<a class="code" href="../../da/d3e/class_u_b_download_http_file.html#a9f6bb9c926934f9076c143d96b0d716f">mId</a>);</div>
<div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;    }</div>
<div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;}</div>
<div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;</div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Fri Nov 1 2013 12:10:12 for Open-Sankoré by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/>
</a> 1.8.1.2
</small></address>
</body>
</html>
